//=depend_on criteria.yml
//=depend_on en.yml
//=depend_on translation.fr.yml
//=depend_on translation.zh-CN.yml
//=depend_on translation.de.yml
//=depend_on translation.ja.yml
<%
  # Don't send to clients the fields they won't use.
  # We *omit* fields, instead # of listing what we'll use.
  # That way, when we add new fields, by default we'll provide them.
  # This is a safer approach for later maintenance.  By doing it this way,
  # if we add a new field and forget to omit them here,
  # the application will still work correctly. This file might be
  # slightly longer than necessary, but at least it won't be *wrong*.
  omit_fields = {
    'description' => 1,
    'details' => 1,
    'rationale' => 1,
    'autofill' => 1
  }
  criteria_for_js = Criteria.to_h.clone
  criteria_for_js.each do |level, criteria_set|
    criteria_set.each do |criterion, fields|
      fields.delete_if {|k,v| omit_fields.key?(k)}
      translations = {}
      I18n.available_locales.each do |locale|
        I18n.t(".criteria.#{level}.#{criterion}", locale).each do |k,v|
          next if omit_fields.key?(k.to_s)
          translations[k.to_s] = {} unless translations.key?(k.to_s)
          translations[k.to_s][locale.to_s] = v
        end
      end
      fields.update(translations)
    end
  end
%>
CRITERIA_HASH_FULL = <%= criteria_for_js.to_json %>;
